# Test Suite for AngularJS → Angular Challenge

## Overview

This test suite validates that modernized Angular applications:
1. **Behave identically** to the legacy AngularJS app (functional equivalence)
2. **Use modern patterns** (Angular 17+, TypeScript, RxJS, Signals)

## Structure

```
tests/
├── e2e/
│   └── behavioral.test.ts     # Tests outputs match golden files
├── unit/
│   └── modern-patterns.test.ts # Tests code quality and patterns
├── package.json
└── README.md
```

## Running Tests

### Prerequisites

1. Generate golden output files first:
```bash
cd ..
node generate-golden-outputs.js
```

2. Place your modernized Angular app in:
```
../../../output/angularjs-to-angular/
```

### Run All Tests

```bash
npm install
npm test
```

### Run Specific Test Suites

```bash
# Behavioral tests only
npm test -- e2e/behavioral.test.ts

# Modern patterns tests only
npm test -- unit/modern-patterns.test.ts
```

### Watch Mode

```bash
npm run test:watch
```

### Coverage Report

```bash
npm run test:coverage
```

## Test Categories

### 1. Behavioral Equivalence Tests (60% of score)

Tests that your modernized app produces **identical outputs** to the legacy app:

- ✅ Filter operations (by department, location, active status)
- ✅ Search operations (case-insensitive, multi-field)
- ✅ Sort operations (ascending, descending, multiple fields)
- ✅ Complex operations (combined filters + sorting)
- ✅ Export format (simplified employee data)
- ✅ Statistics calculation

**How it works:**
1. We run the legacy AngularJS app with known inputs
2. Capture outputs as "golden files"
3. Your modernized app must produce identical JSON outputs

**Example:**
```typescript
// Legacy AngularJS: Filter by department "Engineering"
// Output saved to: expected-outputs/filter-engineering.json

// Your Angular app: Same filter operation
const result = yourService.filterByDepartment('Engineering');

// Test compares:
expect(result).toEqual(goldenFile); // Must match exactly
```

### 2. Modern Patterns Tests (40% of score)

Tests that your code uses **Angular 17+ best practices**:

#### TypeScript Quality
- ✅ Proper `Employee` interface with typed fields
- ✅ No excessive use of `any`
- ✅ Explicit return types on methods
- ✅ Access modifiers (private, public, protected)

#### Standalone Components
- ✅ Components have `standalone: true`
- ✅ No `NgModule` files
- ✅ Proper imports in component metadata

#### RxJS & Observables
- ✅ Services return `Observable<T>`, not callbacks
- ✅ Use of `pipe()` and RxJS operators
- ✅ Templates use `| async` pipe
- ✅ No `.then()/.catch()` - use RxJS instead

#### Signals (Angular 17+)
- ✅ State managed with `signal()`
- ✅ Derived state with `computed()`
- ✅ No manual watchers

#### Change Detection
- ✅ `OnPush` change detection strategy
- ✅ No manual `detectChanges()` calls

#### No Anti-Patterns
- ❌ No global variables (`window.APP_CONFIG`)
- ❌ No DOM manipulation (`document.querySelector`)
- ❌ No `ElementRef` for styling
- ❌ No mutation of input parameters

## Golden Files

Generated by `generate-golden-outputs.js`:

| File | Description | Employee Count |
|------|-------------|----------------|
| `all-employees.json` | All 20 employees | 20 |
| `filter-engineering.json` | Engineering department | 8 |
| `filter-sales.json` | Sales department | 4 |
| `filter-columbus.json` | Columbus location | 6 |
| `filter-active.json` | Active employees only | 18 |
| `search-smith.json` | Search for "smith" | 1 |
| `search-engineer.json` | Search for "engineer" | 8+ |
| `sort-lastname-asc.json` | Sorted by last name ↑ | 20 |
| `sort-lastname-desc.json` | Sorted by last name ↓ | 20 |
| `sort-salary-asc.json` | Sorted by salary ↑ | 20 |
| `sort-hiredate-asc.json` | Sorted by hire date ↑ | 20 |
| `complex-engineering-columbus-active.json` | Combined filters | 3-4 |
| `complex-sales-active-sorted.json` | Filters + sort | 3-4 |
| `export-sample.json` | Export format example | 3 |
| `stats.json` | Statistics summary | N/A |

## Scoring

Tests are weighted:

```
Total: 100 points

Behavioral Tests (60 points):
- Filter operations: 15 pts
- Search operations: 10 pts
- Sort operations: 15 pts
- Complex operations: 10 pts
- Export/Stats: 10 pts

Modern Patterns (40 points):
- TypeScript quality: 10 pts
- Standalone components: 5 pts
- RxJS/Observables: 10 pts
- Signals/State: 5 pts
- No anti-patterns: 10 pts
```

**Pass threshold:** 75/100 points

## Troubleshooting

### Tests failing with "Golden file not found"

Run the generator first:
```bash
node ../generate-golden-outputs.js
```

### Tests can't find your Angular app

Ensure your modernized code is in:
```
../../../output/angularjs-to-angular/src/
```

### Import errors

Make sure your Angular app exports services/components that tests can import.

## Implementation Notes

**For Candidates:**
- Focus on passing behavioral tests first (they're worth more)
- Then refine code quality for modern pattern tests
- Run tests frequently during development
- Tests are deterministic - same inputs always produce same outputs

**For Evaluators:**
- Behavioral tests are automated and objective
- Modern pattern tests may need manual code review for full assessment
- Use test results + manual inspection for final scoring
